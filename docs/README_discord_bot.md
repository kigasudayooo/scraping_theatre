# Discord映画館Bot システム

映画館スクレイピングシステムと連携したDiscord Botです。週次通知とインタラクティブな映画情報検索機能を提供します。

## 🤖 主な機能

### 📅 週次通知機能
- **送信時刻**: 毎週月曜日 朝7:30 JST
- **内容**: 今週・来週の上映映画一覧
- **情報**: 映画タイトル、上映映画館、あらすじ

### 💬 インタラクティブ質問機能
- **自然言語対応**: 日本語での映画質問
- **リアルタイム検索**: 最新の映画情報を取得
- **外部情報統合**: Playwright MCPによる追加情報

## 🛠️ セットアップ

### 1. Discord Bot作成

1. [Discord Developer Portal](https://discord.com/developers/applications)にアクセス
2. 「New Application」でアプリ作成
3. 「Bot」タブでBotユーザー作成
4. 「Token」をコピー（後で使用）

### 2. 必要な権限設定

Bot には以下の権限が必要です：
- `Send Messages`
- `Embed Links`
- `Read Message History`
- `Use Slash Commands`

### 3. 環境設定

```bash
# .envファイル作成
cp .env.example .env

# 必要な値を設定
DISCORD_BOT_TOKEN=your_bot_token_here
DISCORD_MAIN_CHANNEL_NAME=weekly-movies
DISCORD_DETAIL_CHANNEL_NAME=movie-questions
```

### 4. 依存関係インストール

```bash
pip install -r requirements.txt
```

### 5. Bot起動

```bash
python run_discord_bot.py
```

## 📋 チャンネル設定

### メインチャンネル (`weekly-movies`)
- 週次映画情報の自動投稿
- Bot からの一方向通知

### 詳細チャンネル (`movie-questions`)
- ユーザーからの映画質問
- Bot との双方向やり取り

## 💬 使用方法

### 週次通知の例
```
🎬 【今週・来週の上映映画】7/8〜7/21

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎭 『ある映画のタイトル』
📍 上映館: ケイズシネマ、ポレポレ東中野
📅 期間: 7/8(月)〜7/14(日)
💭 心温まる家族の物語。主人公の成長を通して...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 合計: 12作品 | 6映画館
🤖 詳細情報は #映画-質問 で質問してください
```

### 質問の例

**映画情報取得**
```
「タイトル名」について教えて
```

**映画館スケジュール**
```
ケイズシネマの今週の上映予定は？
```

**監督作品検索**
```
監督「山田太郎」の作品を教えて
```

### Bot応答例
```
🎬 『ある映画のタイトル』について

📋 基本情報
┣━ 監督: 山田太郎
┣━ 出演: 佐藤花子、田中次郎
┣━ 上映時間: 120分
┗━ ジャンル: ドラマ

📍 上映情報
┣━ ケイズシネマ: 7/8〜7/14 (10:00, 14:30, 19:00)
┗━ ポレポレ東中野: 7/10〜7/16 (11:00, 15:30)

💭 あらすじ
心温まる家族の物語...

🌐 追加情報
🎥 評価: 4.2/5
🏆 受賞: 東京国際映画祭 最優秀作品賞
```

## ⚙️ コマンド

| コマンド | 説明 |
|---------|------|
| `!help` | ヘルプ表示 |
| `!status` | Bot稼働状況 |
| `!update` | 手動データ更新 |

## 🗂️ ファイル構成

```
scraping_theatre/
├── discord_bot_main.py      # メインBot実行ファイル
├── weekly_notifier.py       # 週次通知システム
├── interactive_bot.py       # インタラクティブ機能
├── discord_config.py        # 設定管理
├── discord_models.py        # Discordデータモデル
├── run_discord_bot.py      # 実行スクリプト
└── .env                    # 環境変数（要作成）
```

## 🔧 高度な設定

### カスタム通知時刻
```bash
# 毎週火曜日 8:00 に変更
WEEKLY_REPORT_TIME=TUE 08:00
```

### Playwright外部検索無効化
```bash
ENABLE_PLAYWRIGHT_SEARCH=false
```

### データ更新間隔変更
```bash
DATA_UPDATE_INTERVAL=12  # 12時間毎
```

## 🚨 トラブルシューティング

### Bot が反応しない
1. **権限確認**: Botに適切な権限があるか
2. **チャンネル名**: 設定されたチャンネル名が正しいか
3. **ログ確認**: `discord_bot.log` でエラーを確認

### 週次通知が送信されない
1. **時刻設定**: `WEEKLY_REPORT_TIME` の形式が正しいか
2. **チャンネルID**: メインチャンネルが見つかっているか
3. **タイムゾーン**: サーバーのタイムゾーン設定

### 映画情報が見つからない
1. **データ更新**: `!update` で最新データを取得
2. **タイトル入力**: 正確な映画タイトルで検索
3. **スクレイピング**: 各映画館サイトが正常に取得できているか

## 📈 監視とログ

### ログファイル
- `discord_bot.log`: Bot活動ログ
- `scraping.log`: スクレイピングログ

### 重要な監視項目
- Bot稼働状況
- 週次通知の送信成功
- スクレイピングエラー頻度
- ユーザー質問の応答率

## 🔐 セキュリティ

- **トークン管理**: `.env` ファイルをGitにコミットしない
- **権限最小**: 必要最小限のBot権限のみ付与
- **ログ監視**: 異常な活動がないか定期確認

## 📞 サポート

問題が発生した場合：
1. ログファイルを確認
2. 設定ファイルを見直し
3. Botの権限とチャンネル設定を確認
4. 必要に応じてBot再起動